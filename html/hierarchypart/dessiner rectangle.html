<html>

    <head>  
        <script src="js/d3.v3.min.js"></script>
        <script src="js/file_json.js"></script>
        <script src="js/tree_largeur.js"></script>
        <script src="js/tree_profondeur.js"></script>
        <script src="js/profondeur et largeur.js"></script>
        <script src="js/draw.js"></script>
        <link rel="stylesheet" type="text/css" href="csss.css">
       <link rel="stylesheet" type="text/css" href="css/css.css">
    </head>
    
    <body>
   		voir logs console
        <div id="timeline"></div>
        <div class="tooltip"></div>
            <div id="hierarchypart"> </div>
    </body>

    <script>


	
    	var file = "mocks/mock2.json"; // Chemin du fichier json
    	var request = open_json(file); // Requete d'ouverture du fichier json
    	var hierarchypart = svg("#hierarchypart",window.innerWidth,3000); // selection d'un svg sur l'id hierarchypart
    	var element = hierarchypart.append("g"); // ajout dans cette hierarchypart une DIV "g" afin de grouper

    	

    	request.onload = function() {
    		/*
    		VARIABLE
    		*/
			let tableau; // variable temporaire
			file = request.response; // recuperation de donnees la requette
      	  	let nodelist = file['ownerlist'][0]['nodelist']; // variable temporaire indiquant le sommet (nodelist)
      		

	  	
		  	
      	  	/*
    		FONCTION			Parcour en largeur sur le sommet nodelist
    		*/
    		parcourire_arbre(nodelist);
    		
      	  	console.log(nodelist);

		  	tableau = nodelist; // tableau vaut la sortie de la fonction branche_niveau
		  	marquer = []; // on reintialise la sortie
		  	
		  	
		
		  	
		  	
		  	
		  	
			/*
    		JEU D'ESSAI			branche_profondeur
    		*/
    		
    		
    		
    		/*
    		FONCTION			largeur rectangle
    		*/
    		function largeur_rect(niveau_actuel, width_max, somme_largeur_parrents){
		  		/* Exemple
		  		sur 5 niveau
		  		
		  		niveau noeu source = 5
		  		
		  		niveau actuelle = 3
		  		width_max = 500
		  		somme_largeur_parrents = 200
		  		
		  		
		  		On soustrait width_max (500) par la somme_largeur_parrents (200) soit 500-200 = 300
		  		qu'on divise par le niveau actuelle: 3 soit 300/3 = 100
		  		qu'on ajoute à la largeur parrents: 200 soit 200+100 = 300
		  		*/
		  		let somme_parrent;
		  		let result = width_max - somme_largeur_parrents;
		  		result = result / niveau_actuel;
		  		somme_parrent += result;
		  		
		  		return [somme_parrent, result];
		  	}
    		
    		
		  	
		  	
		  	
    		/*
    		FONCTION			hauteur rectangle
    		*/
    		function hauteur_rect(feuilles_noeud_n, c){
    			return feuilles_noeud_n * c;
    		}
    		
    		
    		/*
    		FONCTION			position_x rectangle
    		*/
    		
    		/*
    		FONCTION			position_y rectangle
    		*/
    		
    		/*
    		FONCTION			supprimer rectangles
    		*/
    		// Soit un tableau pour un niveau
    		// Soit une dimension pour un noeud en hauteur
    		// un tableau et une dimension peu être vide selon l'emplacement de celui ci
    		//var cacher = [] 
    		
    		
    		//var arbre = []
    		
    		/*
    		Parcourire arbre
    		
    		pour chaque niveau de l'arbre
    		Si l'emplacement du tableau et dimension n'es pas dans cacher
    		afficher le niveau et le sous niveau // Voir si agrandire le niveau ou reduire la part
    		*/
    		
    		
    		/*
    		FONCTION			inscrit la taille de chaque ensemble
    		*/
    		/*
    		function fueilles(liste_sommet){
		  		let f = [1];
		  		liste_sommet.forEach(function(e){
		  			let profondeur = e['profondeur'];
		  			profondeur = parseInt(profondeur);
		  			
		  			if (f[profondeur]){
		  				f[profondeur] ++;
		  			} else {
		  				f[profondeur] = 1;
		  			}
		  			
		  			
		  		});
		  		//console.log(Math.max.apply(null,mafeuille));
		  		return Object.values(f);
		  	}*/
		  	
		  	//mafeuille = fueilles(tableau);
		  	//let feuille_max = Math.max.apply(null,mafeuille);
		  	feuille_max = 8;
		  	//console.log(feuille_max);
    		let width_max = 500; 		// largeur maximum
			let hight_max = 250; 		// hauteur maximum
			let width = 166; 	// largeur d'une part
			let hight = 17;	// hauteur d'une part
			let x = 0;
			let y = 0;
			
			for (key_element in tableau){
				let laPart = tableau[key_element];		// selectionne une hierarchy part
				let laProfondeur = laPart.profondeur;	// selectionne sa profondeur
				let laHauteur = laPart.hauteur;			// selection sa hauteur
				let leUID = laPart.uid					// selection son UID
				
				//console.log(laPart, laHauteur, hight, y);
				
				
	
				ensembleOld = mafeuille[laProfondeur-1];
				hauteurOld = hight_max / ensembleOld;
				ensembleNew = mafeuille[laProfondeur];
				hauteurNew = hauteurOld / ensembleNew;
				ensembleNext = mafeuille[laProfondeur+1];
				hauteurNext = hauteurNew / ensembleNext;
				
				if (!ensembleNext){
					//console.log("Not ensemble", laPart);
				}
				
				hight = hauteurNew;
				
				//console.log(ensembleNew);
				
				x = laProfondeur*width;
				y = laHauteur*hight-hight;
				rectangle(element,x,y,width-3,hight-3,laProfondeur,leUID,"essai()");
				text(element, leUID,x,y);

			  
		  	}

		
			
			/*
    		JEU D'ESSAI			branche_niveau
    		*/


		  	/*
			var x_max = 500;
			var y_max = 200;
			var nombre_niveau = tableau.length;
			var x_niveau = x_max/nombre_niveau;
			var y_niveau;
			var y_sous_niveau;
			var i = 0;
			var x = 0;
			var y = 10;
			
			
			  for (key_element in tableau){
				  i += 1;
				  y = 0;
				  console.log(x);
				  text(element, "Niveau: "+i,x,y);
				  
				  for (key_feature in tableau[key_element]){
					  y_niveau = y_max/tableau[key_element].length;
					  //y_sous_niveau
					  console.log(tableau[parseInt(key_element)+1]);
	
					  var feature = tableau[key_element][key_feature];
					  rectangle(element,x,y,x_niveau-2,y_niveau-2);
					  text(element, feature['uid'],x,y);
					  y += y_niveau;
					  
				  }
				  y_niveau = 0;
				  x = x_niveau*i;
			  }
		*/
	
	
	
	
      	}

   </script>

</html>