<html>

    <head>  
        <script src="js/d3.v3.min.js"></script>
        <script src="js/profondeur et largeur.js"></script>
        <script src="js/draw.js"></script>
        <script src="js/cacher_rect.js"></script>
        <link rel="stylesheet" type="text/css" href="csss.css">
       <link rel="stylesheet" type="text/css" href="css/css.css">
    </head>
    
    <body>
   		voir logs console
   		
   		<button onclick="f_essai()">Click me</button>
   		<input id="text">
        <div id="timeline"></div>
        <div class="tooltip"></div>
            <div id="hierarchypart"> </div>
            
    </body>

    <script>
   

	
    	var file = "mocks/mock2.json"; // Chemin du fichier json
    	var hierarchypart = svg("#hierarchypart",window.innerWidth,3000); // selection d'un svg sur l'id hierarchypart
    	var element = hierarchypart.append("g"); // ajout dans cette hierarchypart une DIV "g" afin de grouper

    	d3.json(file, function(data) {
			 

    		/*
    		VARIABLE
    		*/
			let tableau; // variable temporaire
      	  	let nodelist = data['ownerlist'][0]['nodelist']; // variable temporaire indiquant le sommet (nodelist)
      		/*
			function d3_essai(){
				let listeObjects = nodelist;
				let un_i = 0;
      	  		for (i = 0; i< 4; i++)
      	  			{
      	  		un_i += 1;
      	  		//console.log(nodelist);
      	  		
      	  	console.log("uneListe",listeObjects);
		      	  		var smallData = listeObjects.map(function(d,i) {
		      	  				let nbr_feuilles = 0;
		      	  				let tmp_list;
		      	  				let tmp_int;
		      	  				//Sur un objet
		      	  				//le convertire en tableau
		      	  				tmp_list = Object.values(d);
		      	  				
		      	  				//filtrer ses tableau
		      	  				tmp_list = tmp_list.filter(f => f.constructor.name =="Array");
		      	  				//recuperer leurs taille
		      	  				try {
		      	  					nbr_feuilles = tmp_list[0].length;
		      	  				} catch (e){
		      	  				nbr_feuilles = 1;
		      	  				}
		      	  				
		      	  				
		      	  				//Sur un objet
		      	  				//Ajouter des parametres
				      		  	Object.assign(d,{hauteur: i+1,
				      		  					profondeur: un_i,
				      		  					feuilles: nbr_feuilles});
		      	  				
		      	  				//Transforme l'objet en liste
								let uneListe = Object.values(d);
		      	  				
		      	  				//Dans cette liste on recupere seulement les listes
				      			uneListe = uneListe.filter(f => f.constructor.name == "Array");
				      			//console.log(d,uneListe);
		      	  				//on l'ajoute a la listeObjects
				      			return uneListe[0];
		      	  				//console.log(listeObjects);
				      		  //a.push(uneListe);
				      	  });
		      	  		//console.log("a",smallData[0]		
		      	  	listeObjects = smallData[0];
		      	  	console.log("une passe");
      	  			}
				
      	  	}
      	
			d3_essai();
			*/
		  	//console.log(nodelist);
      	  	/*
    		FONCTION			Parcour en largeur sur le sommet nodelist
    		*/
    		parcourire_arbre(nodelist);
    		
      	  	//console.log(nodelist);

		  	tableau = nodelist; // tableau vaut la sortie de la fonction branche_niveau
	
    		
    		
    		
    		/*
    		FONCTION			position_x rectangle
    		*/
    		
    		/*
    		FONCTION			position_y rectangle
    		*/
    		/*

    		
    		*/
    		
    		
    		

    			
			/*
    		JEU D'ESSAI			branche_niveau
    		*/
			let tabl = tableau;
    		let width_max = 500; 		// largeur maximum
    		let hight_max = 250; 		// hauteur maximum
    		let parent = 0;
    		let c = 15;
    		let x = 0;
    		let y = 0;
    		let profondeur;
			let uid;
			let hauteur;
			let feuilles_noeud;
			let width;
			let hight;
			let constante;
			

    		function redessiner(cnst){
    			constante = cnst;
    			for (i = 1;i < cnst+1;i++){
    				
    				if (i > cacher_parent){
    		
    				}
        			//creation du rectangle
        			if (!cacher_niveau.includes(i)){
        				create_rect(tabl);
        			}
    				
        			parent = width[0];
        			x += width[1];
        			
        			//pour chaque element tableau
        			let m = [];
        			for (e in tabl){
        				let profondeur = tabl[e].profondeur+";"+tabl[e].hauteur;
        				if (cacher_branche.includes(profondeur)){

                		} else {
                			
                			m = m.concat(Object.values(tabl[e]));
          
                		}
        			}

        			//let m = tabl.map(mp => Object.values(mp));

        			//console.log(profondeur + ";" + hauteur, cacher);
        			
        			
        			let qsdfsdf = [];
        			
        			                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    
      
        			tabl = m.filter(f => f.constructor.name == "Array")
        			tabl = tabl.flat();
  

        			
        			//renvoyer tableau
      
        			y = 0;
    			}

    			
    			
    			
    		}
    		
    		
    		
    		
    		redessiner(3);
			
    		function create_rect(sommet){

    			sommet.forEach(function(e){
    				if (e){
    					profondeur = e.profondeur;
        				uid = e.uid;
        				hauteur = e.hauteur;
        				feuilles_noeud = e.feuilles_noeud;
        				width = largeur_rect(constante-profondeur+1, width_max, parent, feuilles_noeud); // largeur d'une part
        				
      
        				hight =  hauteur_rect(feuilles_noeud, c);	// hauteur d'une part
        				
        				
        				//console.log(profondeur, width, parent);
        				rectangle(element,x,y,width[1],hight, profondeur+ ";" + hauteur,uid);
        				text(element, uid,x,y);
    				} else {
    					console.log("nok");
    				}
    				
    				
    				y += hight;
    				
    			});
    			
    		}

	
      	});

   </script>

</html>